<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div style="display:flex;justify-content:center;align-items:center;">
    <div>
        <button type="button" id="start" style="font-size: 48px">TEST</button>    
    </div>
</div>



<script type="text/javascript">
        function onBuyClicked() {
            const SAMSUNG_PAY = 'https://spay.samsung.com';

            if (window.PaymentRequest) {
                alert('SamsungPay available')
            }

            // Use Payment Request API
            var parnterId = 'ACCT_1DFMR2LGVW0K41TL'; // Stripe gateway acct id
            var serviceId = '04c022cbfb714b22a43fd8'; // Samsung service
            var merchantName = 'Tapin2'; //must be identical with merchant name from portal, event name?

            var orderId = '111';//$('#order-id').val();
            var amount = '2.00';//$('#total').val();

            var supportedInstruments = [
                {
                    supportedMethods: [SAMSUNG_PAY],
                    data: {
                        'version': '1', // always 1 until further notice
                        'productId': serviceId, // Service ID from partner portal
                        'merchantGatewayParameter': { 'userId': parnterId },
                        'allowedCardNetworks': ['mastercard', 'visa'],
                        'merchantName': merchantName,
                        'orderNumber': orderId
                    }
                }
            ];

            var details = {
                displayItems: [{
                    label: 'Order amount',
                    amount: { currency: 'USD', value: amount }
                }],
                total: {
                    label: 'Total due',
                    amount: { currency: 'USD', value: amount }
                }
            };
            var options = {
                requestShipping: false,
                requestPayerEmail: true,
                requestPayerPhone: true,
                requestPayerName: true
            };
        // Initialization

  var request = new PaymentRequest(supportedInstruments, details, options);
        request.show().then(result => {
        // POST the result to the server
            return fetch('/pay', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
                ,
                body: JSON.stringify(result.toJSON())
            }).then(res => {
                // Only if successful
                if (res.status === 200) {
                    return res.json();
                } else {
                    throw 'Failure';
                }
            }).then(response => {
            // You should have received a JSON object
                if (response.success == true) {
                    return result.complete('success')
                        ;
                } else {
                    return result.complete('fail')
                        ;
                }
            }).then(() => {
                console.log('Thank you!', result.shippingAddress.toJSON(), result.methodName, result.details.toJSON());
            }).catch(() => {
                return result.complete('fail');
            });
        })
        .catch(function (err) {
            console.error('Uh oh, something bad happened: ' + err.message);
        });
    }
        if (!window.PaymentRequest) {
            // PaymentRequest API is not available - forwarding to legacy form based experience.
            location.href = '/checkout';
        }
        
        
        document.querySelector('#start').addEventListener('click', onBuyClicked);

</script>
</body>
</html>

641
